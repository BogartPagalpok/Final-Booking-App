<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Illusive Studio | Live Heritage Build</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,600;0,700;1,600&family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --gold: #d4af37; 
            --gold-glow: rgba(212, 175, 55, 0.4);
            --bg: #050505; 
            --glass: rgba(255, 255, 255, 0.08); 
            --border: rgba(212, 175, 55, 0.5);
            --font-modegi: 'Cormorant Garamond', serif;
            --success: #00ff88;
            --waitlist: #00ccff;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background-color: var(--bg); color: #fff; font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; height: 100vh; overflow: hidden; }

        .brand-modegi { font-family: var(--font-modegi); text-transform: uppercase; letter-spacing: 5px; font-weight: 700; font-style: italic; text-shadow: 0 0 15px var(--gold-glow); }
        .promo-banner { background: linear-gradient(90deg, #d4af37, #f1d592); color: #000; font-weight: 800; font-size: 0.9rem; padding: 12px; width: 100%; text-align: center; border-radius: 0 0 20px 20px; position: absolute; top: 0; z-index: 100; box-shadow: 0 5px 20px var(--gold-glow); }

        .glass-card { background: var(--glass); backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px); border: 1px solid var(--border); border-radius: 35px; padding: 30px; width: 92%; max-width: 400px; text-align: center; box-shadow: 0 0 30px var(--gold-glow); }
        .screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.5s ease; }
        .hidden { display: none !important; }

        .profile-frame { width: 100px; height: 100px; border-radius: 50%; border: 2px solid var(--gold); margin: 0 auto 15px; overflow: hidden; background: #111; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 20px var(--gold-glow); }
        #profile-img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .avatar-placeholder { font-family: var(--font-modegi); font-size: 2.2rem; color: var(--gold); font-weight: 700; }
        .identity-controls { display: flex; gap: 8px; justify-content: center; margin-bottom: 20px; }
        .mini-btn { background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: var(--gold); padding: 8px 12px; border-radius: 12px; font-size: 9px; font-weight: 800; cursor: pointer; text-transform: uppercase; }

        .cat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 15px 0 25px; }
        .cat-tile { background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 20px; padding: 18px 5px; font-size: 11px; font-weight: 800; cursor: pointer; color: #666; transition: 0.3s; }
        .cat-tile.active { background: rgba(212, 175, 55, 0.15); border-color: var(--gold); color: var(--gold); box-shadow: 0 0 20px var(--gold-glow); }
        
        .scroller { display: flex; overflow-x: auto; gap: 10px; padding: 15px 0; scrollbar-width: none; }
        .date-tile { min-width: 95px; padding: 15px; border: 1px solid var(--border); border-radius: 18px; text-align: center; background: rgba(0,0,0,0.4); transition: 0.3s; }
        .date-tile.active { background: var(--gold); color: #000; }
        .date-tile.waitlist-mode { border-color: var(--waitlist); opacity: 0.5; }

        input { width: 100%; padding: 18px; background: rgba(0,0,0,0.6); border: 1px solid var(--border); border-radius: 15px; color: white; margin-bottom: 12px; text-align: center; }
        .primary-btn { background: var(--gold); color: #000; border: none; padding: 22px; width: 100%; border-radius: 20px; font-weight: 800; text-transform: uppercase; cursor: pointer; }
        
        #custom-alert { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(20px); z-index: 10000; align-items: center; justify-content: center; }
        .copy-toast { position: fixed; bottom: 30px; background: var(--gold); color: #000; padding: 12px 25px; border-radius: 50px; font-weight: 900; font-size: 12px; z-index: 20000; display: none; }
    </style>
</head>
<body>

    <div id="copy-toast" style="position:fixed; bottom:30px; left:50%; transform:translateX(-50%); background:var(--gold); color:#000; padding:12px 25px; border-radius:50px; font-weight:900; display:none; z-index:20000;">REFERRAL COPIED</div>

    <div id="custom-alert" onclick="closeAlert()">
        <div class="glass-card" onclick="event.stopPropagation()">
            <h2 id="alert-title" class="brand-modegi">STUDIO</h2>
            <p id="alert-msg" style="margin: 20px 0; font-size: 14px; color: #bbb;"></p>
            <button onclick="closeAlert()" class="primary-btn">Perfect</button>
        </div>
    </div>

    <section id="scr-landing" class="screen">
        <div class="promo-banner">₱500 OFF YOUR FIRST SESSION — AUTO APPLIED</div>
        <div class="glass-card">
            <h1 class="brand-modegi" style="font-size: 3.5rem; margin: 0;">ILLUSIVE</h1>
            <p style="font-size: 10px; letter-spacing: 5px; color: #555; margin-bottom: 30px; font-weight: 700;">EST. 2022</p>
            <input type="text" id="in-name" placeholder="Full Name">
            <input type="text" id="in-ref-input" placeholder="Referral Code (Optional)" style="border-style: dashed;">
            <button onclick="toBooking()" class="primary-btn">Enter Studio</button>
        </div>
    </section>

    <section id="scr-booking" class="screen hidden" style="opacity: 0;">
        <nav style="position: fixed; top: 0; width: 100%; padding: 25px; display: flex; justify-content: space-between; align-items: center;">
            <div class="brand-modegi" style="font-size: 1rem; color: var(--gold);">ILLUSIVE STUDIO</div>
            <div onclick="toProfile()" id="nav-initial" style="width: 45px; height: 45px; border: 1px solid var(--gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--gold); font-weight: 800; cursor: pointer; overflow: hidden; font-size: 1.2rem;">U</div>
        </nav>
        <div class="glass-card" style="margin-top: 40px;">
            <span style="font-size: 10px; color: var(--gold); letter-spacing: 2px; text-transform: uppercase;">1. Style</span>
            <div class="cat-grid">
                <div class="cat-tile" onclick="selectCat(this, 'Minimalist')">MINIMALIST</div>
                <div class="cat-tile" onclick="selectCat(this, 'Complex')">COMPLEX</div>
            </div>
            <span style="font-size: 10px; color: var(--gold); letter-spacing: 2px; text-transform: uppercase;">2. Date</span>
            <div class="scroller" id="date-scroller"></div>
            <button id="main-btn" onclick="handleConfirm()" class="primary-btn">Book Session</button>
        </div>
    </section>

    <section id="scr-profile" class="screen hidden" style="opacity: 0;">
        <div class="glass-card">
            <div class="profile-frame">
                <span class="avatar-placeholder" id="avatar-text">U</span>
                <img src="" id="profile-img">
            </div>
            <h2 id="client-name" class="brand-modegi" style="font-size: 2rem; margin: 0;">User</h2>
            <div class="identity-controls">
                <label class="mini-btn">Upload Photo <input type="file" hidden onchange="uploadPhoto(this)"></label>
                <button class="mini-btn" onclick="generateAvatar()">Gen Avatar</button>
            </div>
            <div style="background: rgba(212,175,55,0.1); border: 1px dashed var(--gold); padding: 15px; border-radius: 20px; margin-bottom: 20px; cursor: pointer;" onclick="copyReferral()">
                <p style="font-size: 9px; margin: 0; color: #888;">TAP TO COPY CODE</p>
                <div id="my-ref" style="font-weight: 800; color: var(--gold); margin-top: 5px; font-size: 1.2rem; letter-spacing: 2px;">CODE</div>
            </div>
            <div id="apt-list" style="text-align: left; max-height: 100px; overflow-y: auto;"></div>
            <button onclick="backToBooking()" class="primary-btn" style="background: transparent; color: #fff; border: 1px solid var(--border); margin-top: 20px;">Back</button>
        </div>
    </section>

    <script>
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzjWcT3rY6-xu_XHRQMsSbXhp7aynuebdmH5k9tOPxqFWsJCpNov-KY7K-4Kpb_t-5b/exec";
        let client = { name: '', selectedCat: '', bookings: [], isWaitlist: false };
        let existingBookings = [{ date: "FEB 24", style: "Complex" }];
        const months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];

        function uploadPhoto(input) {
            if (input.files && input.files[0]) {
                const r = new FileReader(); r.onload = (e) => {
                    const img = document.getElementById('profile-img');
                    img.src = e.target.result; img.style.display = 'block';
                    document.getElementById('avatar-text').style.display = 'none';
                    document.getElementById('nav-initial').innerHTML = `<img src="${e.target.result}" style="width:100%; height:100%; object-fit:cover;">`;
                }; r.readAsDataURL(input.files[0]);
            }
        }

        function generateAvatar() {
            const colors = ['#d4af37', '#f1d592', '#ffffff', '#aa8439'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            const char = client.name.charAt(0).toUpperCase();
            document.getElementById('profile-img').style.display = 'none';
            const txt = document.getElementById('avatar-text');
            txt.style.display = 'block'; txt.innerText = char; txt.style.color = color;
            const nav = document.getElementById('nav-initial');
            nav.innerHTML = char; nav.style.color = color; nav.style.border = `1px solid ${color}`;
            showPopup("IDENTITY", "Avatar synced.");
        }

        function copyReferral() {
            const code = document.getElementById('my-ref').innerText;
            const el = document.createElement('textarea'); el.value = code; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el);
            const t = document.getElementById('copy-toast'); t.style.display = 'block'; setTimeout(() => t.style.display = 'none', 2000);
        }

        function selectCat(el, val) {
            document.querySelectorAll('.cat-tile').forEach(t => t.classList.remove('active'));
            el.classList.add('active'); client.selectedCat = val; populateDates();
        }

        function populateDates() {
            const scroller = document.getElementById('date-scroller'); scroller.innerHTML = '';
            for(let i=0; i<365; i++) {
                const d = new Date(); d.setDate(d.getDate() + i);
                const dateStr = months[d.getMonth()] + " " + d.getDate();
                const dayBookings = existingBookings.filter(b => b.date === dateStr);
                const isFull = dayBookings.some(b => b.style === "Complex") || dayBookings.length >= 2;
                const isQualityLimited = dayBookings.length > 0 && client.selectedCat === "Complex";
                const tile = document.createElement('div');
                tile.className = 'date-tile';
                if (isFull || isQualityLimited) {
                    tile.classList.add('waitlist-mode');
                    tile.innerHTML = `<div style="font-size:10px; color:var(--gold);">${months[d.getMonth()]}</div><strong>${d.getDate()}</strong><div style="font-size:7px; color:var(--waitlist);">WAITLIST</div>`;
                    tile.onclick = () => { document.querySelectorAll('.date-tile').forEach(t => t.classList.remove('active')); tile.classList.add('active'); setWait(true); };
                } else {
                    let s = client.selectedCat === 'Minimalist' ? (2 - dayBookings.length) : 1;
                    tile.innerHTML = `<div style="font-size:10px; color:var(--gold);">${months[d.getMonth()]}</div><strong>${d.getDate()}</strong><div style="font-size:8px;">${s} slots</div>`;
                    tile.onclick = () => { document.querySelectorAll('.date-tile').forEach(t => t.classList.remove('active')); tile.classList.add('active'); setWait(false); };
                }
                scroller.appendChild(tile);
            }
        }

        function setWait(w) { client.isWaitlist = w; const b = document.getElementById('main-btn'); b.innerText = w ? "Join Waitlist" : "Book Session"; b.style.background = w ? "var(--waitlist)" : "var(--gold)"; }

        async function handleConfirm() {
            const active = document.querySelector('.date-tile.active');
            if(!client.selectedCat || !active) return showPopup("REQUIRED", "Select Style and Date.");
            const date = active.querySelector('div').innerText + " " + active.querySelector('strong').innerText;
            if(client.isWaitlist) return showPopup("WAITLIST", "Waitlist joined.");
            
            const btn = document.getElementById('main-btn'); btn.innerText = "BOOKING..."; btn.style.opacity = "0.5";
            try {
                await fetch(APPS_SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ name: client.name, date: date, style: client.selectedCat }) });
                existingBookings.push({ date: date, style: client.selectedCat });
                client.bookings.unshift({ date: date, style: client.selectedCat });
                showPopup("SUCCESS", "Booked! Syncing to your calendar...");
                updateProfile(); populateDates();
            } catch (e) { showPopup("ERROR", "Sync failed."); }
            btn.innerText = "Book Session"; btn.style.opacity = "1";
        }

        function showPopup(t, m) { document.getElementById('alert-title').innerText = t; document.getElementById('alert-msg').innerText = m; document.getElementById('custom-alert').style.display = 'flex'; }
        function closeAlert() { document.getElementById('custom-alert').style.display = 'none'; }
        function toBooking() { 
            client.name = document.getElementById('in-name').value;
            if(!client.name) return;
            const initial = client.name.charAt(0).toUpperCase();
            document.getElementById('nav-initial').innerText = initial;
            document.getElementById('avatar-text').innerText = initial;
            document.getElementById('client-name').innerText = client.name;
            document.getElementById('my-ref').innerText = "ILL-" + client.name.substring(0,3).toUpperCase() + "22";
            populateDates(); transition('scr-landing', 'scr-booking'); 
        }
        function updateProfile() {
            document.getElementById('apt-list').innerHTML = client.bookings.map(b => `<div style="padding:10px; border-bottom:1px solid #333;"><span style="color:var(--gold); font-weight:700;">${b.date}</span> - ${b.style} <span style="color:var(--success); font-size:9px; float:right;">SYNCED</span></div>`).join('');
        }
        function transition(f, t) { document.getElementById(f).style.opacity = '0'; setTimeout(() => { document.getElementById(f).classList.add('hidden'); document.getElementById(t).classList.remove('hidden'); setTimeout(() => document.getElementById(t).style.opacity = '1', 50); }, 500); }
        function toProfile() { transition('scr-booking', 'scr-profile'); }
        function backToBooking() { transition('scr-profile', 'scr-booking'); }
    </script>
</body>
</html>
